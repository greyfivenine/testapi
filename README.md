# testapi

### Установка

1. Установите Docker.
2. Создайте директорию проекта.
3. Скачайте исходный код проекта при помощи:
    ```sh
    $ git clone https://github.com/greyfivenine/testapi.git
    ```
     Или вручную загрузите ZIP-архив и разархивируйте его в папку проекта.
4. При желании изменить настройки БД откройте файл docker-compose.yml и измените следующие параметры:
	- POSTGRES_DB
	- POSTGRES_USER
	- POSTGRES_PASSWORD

	Если вы внесли изменения в docker-compose.yml, то не забудьте внести их в файл settings.py
5. Откройте консоль в директории проекта и выполните команду:
    ```sh
        $ docker-compose up
    ```
    Данная команда отвечает за запуск приложения. При первом вызове будет произведена первоначальная настройка, а также установка необходимых зависимостей.
6. Приостановите работу приложения сочетанием клавиш *CTRL+C* и выполните поочередно следующие команды:
    ```sh
        $ sudo docker-compose run web python manage.py migrate
    ```
    ```sh
        $ sudo docker-compose run web python manage.py makemigrations api
    ```
    ```sh
        $ sudo docker-compose run web python manage.py migrate api
    ```
    Данные команды создадут необходимые таблицы в БД. Для создание суперпользователя БД введите следующую команду:
     ```sh
        $ sudo docker-compose run web python manage.py createsuperuser
    ```
7. Приложение готово к работе. Запустите приложение командой:
    ```sh
        $ docker-compose up
    ```

### Использование

1. Обработка данных:

        URL:
        ●	/api/v1/upload/

        METHOD:
        ●	POST

        Аргументы:
        ●	deals: файл, содержащий историю сделок.

        Ответ:
        ●	Status: OK - файл был обработан без ошибок;
        ●	Status: Error, Desc: <Описание ошибки> - в процессе обработки файла произошла ошибка.

2. Выдача обработанных данных:

        URL:
        ●	/api/v1/check/

        METHOD:
        ●	GET

        Ответ:
        ●	Поле "response" со списком из 5 клиентов, потративших наибольшую сумму за весь период. Каждый клиент описывается следующими полями:
            -	"username" - логин клиента;
            -	"spent_money" - сумма потраченных средств за весь период;
            -	"gems" - список из названий камней, которые купили как минимум двое из списка "5 клиентов, потративших наибольшую сумму за весь период", и данный клиент является одним из этих покупателей.
